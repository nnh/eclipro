.col-md-12
  .row
    .col-md-9
      h3 = "#{t('.protocol')}: #{@protocol.title}"
    .col-md-3.text-right
      ul.nav.nav-tabs
        li.active
          a href="#editor" data-toggle="tab" = t('.editor')
        li
          - if can? :admin, @protocol
            a#admin-link href="#admin" data-toggle="tab" = t('.admin')
          - else
            a.disabled = t('.admin')

  .row
    .col-md-12
      .tab-content
        .tab-pane.active#editor
          .row.mt-l
            .col-md-4
              = render 'menu', protocol: @protocol, contents: @contents, examples: @examples, instructions: @instructions
            .col-md-8
              = render 'editor', protocol: @protocol, contents: @contents
        .tab-pane#admin
          .row
            .col-md-12
              h3 = t('.edit_title')
              = render 'form'

.modal.fade#no-reviewer-modal tab-index="1" role="dialog" aria-hidden="true"
  .modal-dialog
    .modal-content
      .modal-header
        button.close type="button" data-dismiss="modal" aria-label="Close"
          span aria-hidden="true" x
        h4.modal-title = t('.modal_title')

      .modal-body
        p = t('.modal_text')
        .pull-right
          = button_tag t('.add'), type: :button, class: 'btn btn-default', id: 'no-reviewer-modal-add'
        .pull-right
          = button_tag t('.cancel'), type: :button, class: 'btn btn-default', id: 'no-reviewer-modal-close'

javascript:
  $(function() {
    $('#show-example').addClass('disabled');
    $('#show-instructions').addClass('disabled');

    $('li[id^=section-]').click((e) => {
      let targetId = e.currentTarget.id;
      $('div[id$=-example]').hide();
      $('div[id$=-instructions]').hide();
      $('#' + targetId + '-example').show();
      if ($('#' + targetId + '-example').length === 0) {
        $('#show-example').addClass('disabled')
      } else {
        $('#show-example').removeClass('disabled')
      }
      $('#' + targetId + '-instructions').show();
      if ($('#' + targetId + '-instructions').length === 0) {
        $('#show-instructions').addClass('disabled')
      } else {
        $('#show-instructions').removeClass('disabled')
      }
    });

    $(document).on('click', '.to-under-review', function(e) {
      if ('#{!@protocol.has_reviewer? && (can? :admin, @protocol)}' == 'true') {
        e.preventDefault();
        e.stopImmediatePropagation();
        $('#no-reviewer-modal').modal('show');
      }
    });

    $('#no-reviewer-modal-close').click(() => {
      $('#no-reviewer-modal').modal('hide');
    });
    $('#no-reviewer-modal-add').click(() => {
      $('#no-reviewer-modal').modal('hide');
      $('#admin-link').tab('show');
      $('#go-to-three').click();
    });

    $('.section-link').click((e) => {
      $.ajax({
        dataType: 'script',
        data: {
          protocol_id: '#{@protocol&.id}',
          section_no: $(e.target).data('section-no')
        },
        url: '#{show_section_protocol_path}'
      });
    });

    $('#previous-section-button').click(() => {
      move_section('#{previous_section_protocol_path}');
    });
    $('#next-section-button').click(() => {
      move_section('#{next_section_protocol_path}');
    });
    function move_section(url) {
      $.ajax({
        dataType: 'script',
        data: {
          protocol_id: '#{@protocol&.id}',
          section_no: $($("ul#section-ul li.active")[0]).data('section-no')
        },
        url: url
      });
    }
  });
